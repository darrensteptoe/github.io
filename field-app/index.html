<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Field Path Engine — Darren Steptoe Consulting</title>
  <meta name="description" content="Internal field planning dashboard." />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-title">Field Path Engine <span class="chip">v1.0</span></div>
      <div class="brand-sub">Darren Steptoe Consulting — Internal Use Only</div>
    </div>

    <div class="topbar-actions">
      <div class="scenario">
        <label class="label" for="scenarioName">Scenario</label>
        <input id="scenarioName" class="input input-sm" type="text" placeholder="e.g., IL HD-XX — Primary Path" />
      </div>

      <div class="toolbar">
        <button id="btnSaveJson" class="btn btn-sm" type="button">Save JSON</button>
        <label class="btn btn-sm btn-ghost" for="loadJson">Load JSON</label>
        <input id="loadJson" type="file" accept="application/json" hidden />
        <span class="divider"></span>
        <label class="switch">
          <input id="toggleTraining" type="checkbox" />
          <span class="slider"></span>
          <span class="switch-label">Training</span>
        </label>
        <label class="switch">
          <input id="toggleDark" type="checkbox" />
          <span class="slider"></span>
          <span class="switch-label">Dark</span>
        </label>
      </div>
    </div>
  </header>

  <main class="shell">
    <section class="left">
      <div class="card">
        <div class="card-head">
          <h2>Scenario setup</h2>
        </div>
        <div class="grid2">
          <div class="field">
            <label class="label" for="raceType">Race template</label>
            <select id="raceType" class="select">
              <option value="federal">Federal (US House)</option>
              <option value="state_leg" selected>State legislative</option>
              <option value="municipal">Municipal / ward</option>
              <option value="county">County / regional</option>
            </select>
            <div class="help" data-help="Template sets conservative default ranges. You can override anything.">
              <span class="help-title">What this is</span>
              <span class="help-text">Select a baseline assumptions profile (turnout band width defaults, etc.).</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="electionDate">Election date</label>
            <input id="electionDate" class="input" type="date" />
            <div class="help" data-help="Used to estimate weeks remaining. You can override weeks manually below.">
              <span class="help-title">Why it matters</span>
              <span class="help-text">Timeline affects later production planning (Phase 3+). For Phase 1 it’s reference only.</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="weeksRemaining">Weeks remaining (override)</label>
            <input id="weeksRemaining" class="input" type="number" min="0" step="1" placeholder="auto" />
            <div class="help" data-help="If blank, the dashboard estimates based on election date.">
              <span class="help-title">If unsure</span>
              <span class="help-text">Leave blank; you can set it later when production planning is added.</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="mode">Mode</label>
            <select id="mode" class="select">
              <option value="persuasion" selected>Persuasion-first (default)</option>
              <option value="late_start">Late-start / turnout-heavy</option>
            </select>
            <div class="help" data-help="Mode influences defaults later. Phase 1 remains the same.">
              <span class="help-title">What this changes</span>
              <span class="help-text">In later phases, persuasion-first emphasizes persuasion volume before GOTV surge.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h2>Universe</h2>
        </div>
        <div class="grid2">
          <div class="field">
            <label class="label" for="universeBasis">Universe basis</label>
            <select id="universeBasis" class="select">
              <option value="registered" selected>Registered (default)</option>
              <option value="active">Active (advanced)</option>
            </select>
            <div class="help" data-help="Registered is most publicly defensible. Active can be used when file hygiene is strong.">
              <span class="help-title">Best practice</span>
              <span class="help-text">Use Registered in client-facing work unless Active is clearly sourced and agreed.</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="universeSize">Universe size (U)</label>
            <input id="universeSize" class="input" type="number" min="0" step="1" placeholder="e.g., 52000" />
            <div class="help" data-help="U is the base for turnout votes and persuasion universe.">
              <span class="help-title">How it’s used</span>
              <span class="help-text">Turnout votes = U × turnout %. Persuasion universe = U × persuasion %.</span>
            </div>
          </div>

          <div class="field span2">
            <label class="label" for="sourceNote">Source note (optional)</label>
            <input id="sourceNote" class="input" type="text" placeholder="e.g., VAN export dated 2026-02-01 or Elections dept file" />
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h2>Turnout baseline (last two comparable cycles)</h2>
        </div>

        <div class="grid3">
          <div class="field">
            <label class="label" for="turnoutA">Cycle A turnout %</label>
            <input id="turnoutA" class="input" type="number" min="0" max="100" step="0.1" placeholder="e.g., 39" />
            <div class="help" data-help="Comparable cycle means similar election type (midterm vs presidential; primary vs general).">
              <span class="help-title">If unsure</span>
              <span class="help-text">Pick the closest two cycles by election type and district boundaries.</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="turnoutB">Cycle B turnout %</label>
            <input id="turnoutB" class="input" type="number" min="0" max="100" step="0.1" placeholder="e.g., 43" />
          </div>

          <div class="field">
            <label class="label" for="bandWidth">Band width (±)</label>
            <input id="bandWidth" class="input" type="number" min="0" max="25" step="0.5" placeholder="e.g., 4" />
            <div class="help" data-help="Creates Best/Expected/Worst turnout scenarios around your 2-cycle average.">
              <span class="help-title">Typical</span>
              <span class="help-text">±3 to ±5 is common. Keep it modest unless a unique cycle is expected.</span>
            </div>
          </div>

          <div class="field span3 inline-metrics">
            <div class="metric">
              <div class="metric-k">Expected turnout %</div>
              <div id="turnoutExpected" class="metric-v">—</div>
            </div>
            <div class="metric">
              <div class="metric-k">Best / Worst turnout %</div>
              <div id="turnoutBand" class="metric-v">—</div>
            </div>
            <div class="metric">
              <div class="metric-k">Votes per 1% turnout</div>
              <div id="votesPer1pct" class="metric-v">—</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <h2>Candidates & vote landscape</h2>
          <div class="card-actions">
            <button id="btnAddCandidate" class="btn btn-sm btn-ghost" type="button">Add candidate</button>
          </div>
        </div>

        <div class="field">
          <label class="label" for="yourCandidate">You are</label>
          <select id="yourCandidate" class="select"></select>
        </div>

        <div class="table-wrap">
          <table class="table" aria-label="Candidate support table">
            <thead>
              <tr>
                <th>Name</th>
                <th class="num">Support %</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="candTbody"></tbody>
            <tfoot>
              <tr>
                <td class="muted">Undecided</td>
                <td class="num"><input id="undecidedPct" class="input input-sm num" type="number" min="0" max="100" step="0.1" /></td>
                <td></td>
              </tr>
              <tr>
                <td class="muted"><strong>Total</strong></td>
                <td class="num"><strong id="supportTotal">—</strong></td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="grid2">
          <div class="field">
            <label class="label" for="undecidedMode">Undecided break</label>
            <select id="undecidedMode" class="select">
              <option value="proportional" selected>Proportional</option>
              <option value="user_defined">User-defined split</option>
              <option value="against">Conservative against you</option>
              <option value="toward">Conservative toward you</option>
            </select>
            <div class="help" data-help="Undecided allocation is a primary source of volatility in multi-candidate races.">
              <span class="help-title">Best practice</span>
              <span class="help-text">Stress-test against you. Don’t rely on a friendly break.</span>
            </div>
          </div>

          <div class="field" id="userSplitWrap" hidden>
            <label class="label">User-defined undecided split %</label>
            <div id="userSplitList" class="user-split"></div>
            <div class="note">Must sum to 100% across candidates.</div>
          </div>
        </div>

        <div class="banner warn" id="candWarn" hidden></div>
      </div>

      <div class="card">
        <div class="card-head">
          <h2>Persuasion universe</h2>
        </div>
        <div class="grid2">
          <div class="field">
            <label class="label" for="persuasionPct">Persuasion % of universe</label>
            <input id="persuasionPct" class="input" type="number" min="0" max="100" step="0.1" placeholder="e.g., 30" />
            <div class="help" data-help="A modeling assumption: portion of registered voters who are not locked and could move.">
              <span class="help-title">If unsure</span>
              <span class="help-text">Use 30% for competitive/open; 25% for incumbent race; higher for chaotic municipal fields.</span>
            </div>
          </div>

          <div class="field">
            <label class="label" for="earlyVoteExp">Early vote % of turnout (Expected)</label>
            <input id="earlyVoteExp" class="input" type="number" min="0" max="100" step="0.1" placeholder="e.g., 38" />
            <div class="help" data-help="Used as a risk lever; later phases will model chase and timeline compression more deeply.">
              <span class="help-title">Risk lever</span>
              <span class="help-text">Higher early vote compresses persuasion window and increases early workload.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="card sticky-bottom">
        <div class="card-head">
          <h2>Validation</h2>
        </div>
        <ul id="validationList" class="validation"></ul>
      </div>
    </section>

    <section class="right">
      <nav class="tabs" aria-label="Output tabs">
        <button class="tab active" data-tab="win">Win path</button>
        <button class="tab" data-tab="assumptions">Assumptions</button>
      </nav>

      <section class="panel active" id="tab-win">
        <div class="card">
          <div class="card-head">
            <h2>Win path (Expected)</h2>
          </div>

          <div class="kpis">
            <div class="kpi">
              <div class="kpi-k">Projected turnout votes</div>
              <div id="kpiTurnoutVotes" class="kpi-v">—</div>
              <div class="kpi-s" id="kpiTurnoutBand">—</div>
            </div>
            <div class="kpi">
              <div class="kpi-k">Dynamic win threshold</div>
              <div id="kpiWinThreshold" class="kpi-v">—</div>
              <div class="kpi-s">Top competitor + 1 (after undecided allocation)</div>
            </div>
            <div class="kpi">
              <div class="kpi-k">Your projected votes</div>
              <div id="kpiYourVotes" class="kpi-v">—</div>
              <div class="kpi-s" id="kpiYourVotesShare">—</div>
            </div>
            <div class="kpi">
              <div class="kpi-k">Persuasion votes needed (net)</div>
              <div id="kpiPersuasionNeed" class="kpi-v">—</div>
              <div class="kpi-s" id="kpiPersuasionStatus">—</div>
            </div>
          </div>

          <div class="subgrid">
            <div class="mini">
              <div class="mini-k">Early votes (Expected)</div>
              <div id="miniEarlyVotes" class="mini-v">—</div>
              <div class="mini-s" id="miniEarlyNote">—</div>
            </div>
            <div class="mini">
              <div class="mini-k">Election Day votes (Expected)</div>
              <div id="miniEDVotes" class="mini-v">—</div>
              <div class="mini-s">Turnout − Early</div>
            </div>
            <div class="mini">
              <div class="mini-k">Persuasion universe</div>
              <div id="miniPersUniverse" class="mini-v">—</div>
              <div class="mini-s" id="miniPersCheck">—</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <h2>Stress test summary (client style)</h2>
          </div>
          <div id="stressBox" class="stress">
            <div class="stress-item">—</div>
          </div>
          <div class="note">
            Export mode B (future) can include full tables; Version 1 output keeps this summary concise.
          </div>
        </div>

        <div class="card" id="explainCard" hidden>
          <div class="card-head">
            <h2>Explainability</h2>
          </div>
          <div class="explain">
            <details open>
              <summary>What this model is doing</summary>
              <div class="explain-body">
                <p>This tool defines operational requirements under stated assumptions. It does not predict outcomes.</p>
                <ul>
                  <li>Turnout votes = Universe × turnout %</li>
                  <li>Projected votes per candidate = Turnout votes × support %</li>
                  <li>Undecided votes are allocated by your chosen rule</li>
                  <li>Win threshold = top competitor (after allocation) + 1</li>
                  <li>Persuasion votes needed = win threshold − your projected votes</li>
                </ul>
              </div>
            </details>
          </div>
        </div>
      </section>

      <section class="panel" id="tab-assumptions">
        <div class="card">
          <div class="card-head">
            <h2>Assumptions snapshot</h2>
          </div>
          <div id="assumptionsSnapshot" class="assumptions"></div>
          <div class="note">
            This is the exact assumption block we’ll mirror in branded exports in later phases.
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <h2>Warnings & guardrails</h2>
          </div>
          <div id="guardrails" class="guardrails"></div>
        </div>
      </section>
    </section>
  </main>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
